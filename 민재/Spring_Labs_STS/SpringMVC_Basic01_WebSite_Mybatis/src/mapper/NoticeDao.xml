<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.NoticeDao">
	<!-- 파라미터 1개 : 생략 가능 /// 파라미터 2개 이상 & DTO 없는 경우 : hashMap or
		파라미터 2개 이상 & DTO 있는 경우 : vo.Notice
		
		Key Point
		파라미터 1개 생략 : #{value}	>> 1개는 param1 적용 x
		파라미터 2개 이상 : getCount(String field, String query)
		>> String field > param1	==> 순서대로 param 받는다
		>> String query > param2
	  -->
	<select id="getCount" resultType="Integer">
		select count(*) cnt
		from notices
		where ${param1} like '%${param2}%'
	</select>
	
	<!-- public List<Notice> getNotices(int page, String field, String query)
		파라미터를 사용해 로직이 구성되어있다
		int srow = 1 + (page-1)*5;
		int erow = 5 + (page-1)*5;
		
		파라미터 3개를 받고있다
	-->
	<select id="getNotices" resultType="vo.Notice">
		select * from
			 (SELECT ROWNUM NUM, N.* 
			  FROM (SELECT * FROM NOTICES WHERE ${param2} LIKE '%${param3}%' ORDER BY REGDATE DESC) N)
		WHERE NUM BETWEEN 1+(${param1}-1)*5  AND 5+(${param1}-1)*5
	</select>
	<!--  
		public Notice getNotice(String seq)
		파라미터 1개는 생략 가능 : param1 적용 x
	-->
	<select id="getNotice" resultType="vo.Notice">
		SELECT seq, title, writer, content, regdate, hit, fileSrc, fileSrc2 
		FROM NOTICES 
		WHERE SEQ=#{seq}
	</select>
	<!-- public int delete(String seq) 
		delete, insert, update :: resultType 필요없다
	-->
	<delete id="delete">
		DELETE NOTICES 
		WHERE SEQ=#{seq}
	</delete>
	<!-- public int update(Notice notice) 
		원칙적인 방법 : id="update" parameterType="vo.Notice"
		vo, DTO 타입은 파라미터 사용 시 생략 가능하다 : 가독성은 떨어지지만 코드는 줄일 수 있다
		
		FILESRC = #{filesrc}
		FILESRC2 = #{filesrc2}
		파일 수정할 때 null, null 들어 올 수 있다 or
		파일 1개 수정 param1 , null or
		파일 2개 수정
		
		#{fileSrc,jdbcType=varchar} 정의 값이 없으면 기본타입으로 update 된다
		
	-->
	<update id="update" parameterType="vo.Notice">
		UPDATE NOTICES 
		SET TITLE = #{title}, 
			CONTENT = #{content}, 
			FILESRC = #{fileSrc, jdbcType=VARCHAR} , 
			FILESRC2 = #{fileSrc2, jdbcType=VARCHAR} 
		WHERE SEQ=#{seq}
	</update>
	<!-- public int insert(Notice n) 
	INSERT INTO NOTICES(SEQ, TITLE, CONTENT, WRITER, REGDATE, HIT, FILESRC , FILESRC2) 
	VALUES( (SELECT MAX(TO_NUMBER(SEQ))+1 FROM NOTICES), ?, ?, 'newleckosta', SYSDATE, 0, ?,?)
	
	파라미터 생략 가능
	-->
	<insert id="insert">
		<selectKey order="BEFORE" keyProperty="seq" resultType="String">
			select max(to_number(seq))+1 from notices
		</selectKey>
		INSERT INTO NOTICES(SEQ, TITLE, CONTENT, WRITER, REGDATE, HIT, FILESRC , FILESRC2) 
		  	VALUES(#{seq}, #{title}, #{content}, 'bituser', SYSDATE, 0, 
		  			#{fileSrc, jdbcType=VARCHAR}, #{fileSrc2, jdbcType=VARCHAR})
	</insert>
</mapper>